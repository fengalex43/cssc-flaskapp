#!/bin/bash

base_image_registry=$1
base_image_repository=$2
base_image_tag=$3

cat trivy-results.txt | grep "Total:"

vuln_count=$(cat trivy-results.txt | grep "Total:" | awk -F'[^0-9]+' '{print $2}')
echo "Number of vulnerabilities found in the base image $base_image_registry/$base_image_repository:$base_image_tag:" $vuln_count
if [[ $vuln_count -eq 0 ]]; then
  echo "No vulnerabilities found in the base image $base_image_registry/$base_image_repository:$base_image_tag"
  exit 0
else
  echo "Vulnerabilities found in the base image $base_image_registry/$base_image_repository:$base_image_tag"
  exit 1
fi